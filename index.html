<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css"
    href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
  <link href="https://fonts.cdnfonts.com/css/open-sans" rel="stylesheet">
  <link href="./assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="icon" type="image/x-icon" href="./img/favicon.ico">
  <title>Teledyne Marine - Github access</title>
  <link rel="stylesheet" type="text/css" href="./css/common.css" />
  <link rel="stylesheet" type="text/css" href="./css/tdy.css" />
  <style>
    #accessForm {
      /* Initial state */
      transition: opacity 0.3s ease-in-out;
    }

    .collapse {
      /* Hidden and collapsed state */
      opacity: 0;
      display: none;
    }
  </style>


</head>
<nav class="navbar navbar-expand-lg navbar-dark"
  style="background: linear-gradient(180deg, rgba(16, 52, 81, 0.2) 34.38%, rgba(1, 18, 30, 0.2) 74.48%), #0B263B;">
  <a> <img class="tdy-nav-logo" src="./img/teledyne_marine.svg">
    <!-- <div class="tdy-nav-logo">{% include "img/teledyne_marine.svg" %}</div>-->
  </a>


</nav>

<body>
  <form action="javascript:void(0);" enctype="multipart/form-data" id="actualForm">
    <div class="container" style="display: flex;flex-direction: row; justify-content: center; align-items: flex-start;">

      <div class="tdy-information-data">
        <div class="form-group" style="margin-right: 10px;">
          <h2></h2>
          <input type="checkbox" class="form-check-input" id="confirmation2" name="github7kheaders" checked>

        </div>
        <div class="tdy-information-data-icon-window">
          <img class="tdy-information-data-icon" style="width: 48px;height: 48px;" src="./img/icons/github-mark.svg">
        </div>
        <div class="tdy-information-data-title-window" style="width: 300px;">
          <h2><a href="https://github.com/Teledyne-Marine/7k">7k Headers</a></h2>

          This collection of 7k Headers contains the data format definition of the 7k protocol as well as access to
          C++/C# example code.
        </div>
      </div>
    </div>
    <div class="container" style="display: flex;flex-direction: row; justify-content: center; align-items: flex-start;">


      <div class="tdy-information-box" style="width: 90%">
        <h2>Get Access</h2>
        Please fill out the form below to request access to the selected public GitHub repositories. Once you have been
        granted
        access, you will be able to access as a user and contributor to the Teledyne GitHub repositories you have
        selected
        above.
        <hr>

        <div style="margin-left: 15px; margin-bottom: 15px;" id="accessForm" class="accessFormClass">
          <div style="margin-right: 15px;">
            <div class="form-group" style="margin-top: 10px;">
              <h2>First name*</h2>
              <input type="text" placeholder="First name" name="firstName" class="form-control" required>
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>Last name*</h2>
              <input type="text" placeholder="Last name" name="lastName" class="form-control" required>
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>Github email address*</h2>
              <input type="email" placeholder="Github email address" name="emailAdress" class="form-control" required>
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>Full company name (if applicable)</h2>
              <input type="text" placeholder="Full company name" name="companyName" class="form-control">
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>Address row 1*</h2>
              <input type="text" placeholder="Address row 1" name="companyAddress" class="form-control" required>
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>Address row 2</h2>
              <input type="text" placeholder="Address row 2" name="companyAddressTwo" class="form-control">
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>City*</h2>
              <input type="text" placeholder="City" name="city" class="form-control" required>
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>Zip*</h2>
              <input type="text" placeholder="Zip" name="zip" class="form-control" required>
            </div>
            <div class="form-group" style="margin-top: 10px;">
              <h2>Country*</h2>
              <input type="text" placeholder="Country" name="country" class="form-control" required>
            </div>

            <div class="form-check" style="margin-top: 20px;">
              <input type="checkbox" class="form-check-input" id="confirmation" required>
              <label class="form-check-label" for="confirmation">I confirm that the information provided above is
                accurate and
                correct</label>
            </div>

            <div class="form-check" style="margin-top: 20px;">
              <input type="checkbox" class="form-check-input" id="privacyAgreement" required>
              <label class="form-check-label" for="privacyAgreement">I agree to <a
                  href="https://www.teledyne.com/privacy-policy/">
                  Teledyneâ€™s Privacy Policy</a></label>
            </div>

          </div>
        </div>
        <button type="submit" id="submit" class="btn btn-primary">Submit</button>



        <div id="error" style="color: red;"></div>
        <div id="success" style="color: green;"></div>


      </div>
    </div>
    </div>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>

  <script>

    function hasKeyStartingWithValue(obj, value) {
      for (const key in obj) {

        if (key.startsWith(value)) {
          return true;
        }
      }
      return false;
    }


    document.getElementById("submit").addEventListener("click", function () {

      var form = document.getElementById("actualForm");

      if (!form.checkValidity()) {
        return;
      }

      var formData = new FormData(form);
      var jsonData = {};
      //Note: Checkboxes only appear if they are 'on'(checked)
      formData.forEach(function (value, key) {
        jsonData[key] = value;
      });

      if (!hasKeyStartingWithValue(jsonData, "github")) {

        document.getElementById("error").innerHTML = "Please select at minimal one repository.";
        return;
      }

      //  Send JSON data to a server using fetch
      fetch('https://h3skk3vdiak5qq6lg5kqjbb3mu0lvtky.lambda-url.eu-central-1.on.aws/', {
        method: 'POST',
        body: JSON.stringify(jsonData),
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => {
          if (response.status == 200) {
            console.log(response)

            document.getElementById("success").innerHTML = "Request received successfully! When succesful you will get an email from github to add you as a collaborator to the selected projects";
            var innerHtmlElement = document.getElementById("success");
            var table = document.createElement("table");
            table.setAttribute("cellpadding", "5");
            table.setAttribute("cellspacing", "0");
            table.setAttribute("width", "100%");
            table.setAttribute("color", "green");
            table.style.fontFamily = "Arial";

            var fieldMapping = {
              "Github Email": "emailAdress",
              "Name": "firstName",
              "Last name": "lastName",
              "Company": "companyName",
              "Address": "companyAddress",
              "": "companyAddressTwo",
              "City": "city",
              "Zip Code": "zipCode",
              "Country": "country"
            };

            for (var fieldName in fieldMapping) {
              var tr = document.createElement("tr");

              var td1 = document.createElement("td");
              td1.setAttribute("width", "30%");
              td1.setAttribute("align", "left");
              td1.textContent = fieldName;
              td1.style.color = "green";

              var td2 = document.createElement("td");
              td2.setAttribute("align", "left");
              td2.textContent = formData.get(fieldMapping[fieldName]);
              td2.style.color = "green";

              tr.appendChild(td1);
              tr.appendChild(td2);
              table.appendChild(tr);
            }

            innerHtmlElement.appendChild(table)
            document.getElementById('accessForm').classList.add('collapse');


            var elementToRemove = document.getElementById('submit');

            // Check if the element exists before attempting to remove it
            if (elementToRemove) {
              elementToRemove.parentNode.removeChild(elementToRemove);
            }

          } else {
            document.getElementById("error").innerHTML = "Form submission failed. Please try again.";
          }
        }).catch(error => {
          console.error('Error:', error);
          document.getElementById("error").innerHTML = "An error occurred while submitting the form.";


        });
    });
  </script>
</body>


</html>